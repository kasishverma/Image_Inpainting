import streamlit as st
import pandas as pd

# Function to check if the date range is more than 30 days
def is_valid_date_range(date1, date2):
    return (date2 - date1).days <= 30

# Initialize date variables with default values or any suitable default date
date1, date2 = pd.to_datetime('2023-01-01'), pd.to_datetime('2023-12-31')

# Use on_event to capture changes in the date_range input
date_range = st.date_input("Pick a date range", (date1.date() if date1 else None, date2.date() if date2 else None), key="date_range")

# Listen for changes in the date_range input
if st.session_state.date_range_changed:
    # Extract start and end dates from the selected date range
    date1, date2 = date_range

    # Convert date to datetime for comparison
    date1 = pd.to_datetime(date1)
    date2 = pd.to_datetime(date2)

    # Check if the date range is valid (not more than 30 days)
    if not is_valid_date_range(date1, date2):
        st.error("Please select a date range of maximum 30 days.")
        # Set date variables back to default or handle as needed
        date1, date2 = pd.to_datetime('2023-01-01'), pd.to_datetime('2023-12-31')

# Trigger date_range_changed event when date_range changes
st.session_state.date_range_changed = st.session_state.date_range != date_range

# "Apply Filter" button
submitted_filter = st.button("Apply Filter")

# Check if the date filter form was submitted
if submitted_filter:
    # Check if the date range is valid (not more than 30 days)
    if not is_valid_date_range(date1, date2):
        st.error("Please select a date range of maximum 30 days.")
        # Set date variables back to default or handle as needed
        date1, date2 = pd.to_datetime('2023-01-01'), pd.to_datetime('2023-12-31')

# Rest of your code...
