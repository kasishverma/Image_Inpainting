import streamlit as st
import pandas as pd

# Function to check if the date range is more than 30 days
def is_valid_date_range(date1, date2):
    return (date2 - date1).days <= 30

# Initialize date variables with default values or any suitable default date
date1, date2 = pd.to_datetime('2023-01-01'), pd.to_datetime('2023-12-31')

# HTML and JavaScript code for client-side validation
script = """
<script>
    // Function to validate the date range
    function validateDateRange() {
        var startDate = new Date(document.getElementById("date-range-start").value);
        var endDate = new Date(document.getElementById("date-range-end").value);
        var maxDays = 30;

        // Check if the date range is more than 30 days
        if ((endDate - startDate) / (1000 * 60 * 60 * 24) > maxDays) {
            alert("Please select a date range of maximum 30 days.");
            return false;
        }
        return true;
    }

    // Attach event listener to the date inputs
    document.getElementById("date-range-start").addEventListener("change", validateDateRange);
    document.getElementById("date-range-end").addEventListener("change", validateDateRange);
</script>
"""

# Inject the JavaScript code
st.markdown(script, unsafe_allow_html=True)

# Date range input
date_range = st.date_input("Pick a date range", (date1.date() if date1 else None, date2.date() if date2 else None), key="date_range")

# "Apply Filter" button
submitted_filter = st.button("Apply Filter")

# Check if the date filter form was submitted
if submitted_filter:
    # Extract start and end dates from the selected date range
    date1, date2 = date_range

    # Convert date to datetime for comparison
    date1 = pd.to_datetime(date1)
    date2 = pd.to_datetime(date2)

    # Check if the date range is valid (not more than 30 days)
    if not is_valid_date_range(date1, date2):
        st.error("Please select a date range of maximum 30 days.")
        # Set date variables back to default or handle as needed
        date1, date2 = pd.to_datetime('2023-01-01'), pd.to_datetime('2023-12-31')

# Rest of your code...
