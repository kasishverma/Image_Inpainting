import pandas as pd
import streamlit as st
from pm4py.objects.log.importer.xes import factory as xes_importer
from pm4py.objects.petri.importer import importer as petri_importer
from pm4py.visualization.petrinet import factory as pn_vis_factory

# Create a Streamlit app
st.title("Petri Net Graph from DataFrame")

# Upload a CSV file containing your event log data
uploaded_file = st.file_uploader("Upload your event log (CSV format)", type=["csv"])

if uploaded_file is not None:
    # Load the event log from the CSV file
    log = pd.read_csv(uploaded_file)
    
    # Convert the DataFrame to an XES event log
    from pm4py.objects.log.log import EventLog
    from pm4py.objects.log.log import EventStream
    event_log = EventLog()
    for idx, row in log.iterrows():
        event = {'concept:name': row['activity'], 'time:timestamp': pd.to_datetime(row['timestamp'])}
        event_stream = EventStream()
        event_stream.append(event)
        event_log.append(event_stream)

    # Create a Petri net from the event log
    net, initial_marking, final_marking = petri_importer.apply(event_log)

    # Visualize the Petri net
    st.subheader("Petri Net Visualization")
    st.write("This is the Petri Net graph of your event log:")
    petrinet_image = pn_vis_factory.apply(net, initial_marking, final_marking)
    st.image(petrinet_image, caption="Petri Net Graph", use_container_width=True)

    # You can add more content to your Streamlit app as needed
    # For example, you can include statistics or other visualizations related to your data
